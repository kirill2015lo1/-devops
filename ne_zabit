kubectl drain <worker-node-name>
Эта команда используется для освобождения узла (например, worker-узла) от запущенных на нем подов, чтобы подготовить его для обслуживания или удаления.

--ignore-daemonsets: Эта опция указывает, что поды, управляемые DaemonSets, не будут удалены, так как они должны быть на каждом узле.

Не забыть taints и label,как указывать и тп почитать


Смотри получается label от taint у node отличается от тем, что если при создании deployment не указать nodeselector и там указать определенный label, то создание подов будет только на узле с этим label, но если не указывать ничего, то создание будет на подов на всех узлах, даже с разными другими labels
Но если node указать какой то taint, то поды на нем буду создавать только при обязательном указании tolerations, если не указать никакой taint при создании deployment, то deployment ни при каком условии не будет создавать pod на нодах каких либо taint 
ChatGPT сказал:
ChatGPT
Ты правильно понял разницу между labels, taints и tolerations. Давай уточним основные моменты, чтобы все было более ясно:

1. Labels
Labels на узлах используются для выбора определенных узлов для запуска подов. Например, если вы хотите, чтобы поды запускались только на узлах с определенным label, вы можете указать это в nodeSelector в манифесте Deployment.

Пример:

yaml
Копировать код
apiVersion: apps/v1
kind: Deployment
metadata:
  name: my-app
spec:
  replicas: 3
  selector:
    matchLabels:
      app: my-app
  template:
    metadata:
      labels:
        app: my-app
    spec:
      containers:
      - name: my-app
        image: nginx
      nodeSelector:
        kubernetes.io/os: linux
В этом примере nodeSelector говорит Kubernetes, что поды должны запускаться только на узлах с label kubernetes.io/os: linux.

Если nodeSelector не указан, поды могут быть назначены на любой узел в кластере, независимо от того, какие у них labels.
2. Taints и Tolerations
Taints — это механизм, который отключает узлы от принятия подов, если поды не имеют соответствующей toleration (терпимости) для этого taint. Т.е. если узел имеет taint, то Kubernetes будет игнорировать его для подов, если они не "терпят" (tolerate) этот taint.

Tolerations в манифесте пода указывают, что под может быть назначен на узел с определенным taint, если это необходимо.

Пример:

У вас есть узел с taint:

bash
Копировать код
kubectl taint nodes worker1 key=value:NoSchedule
Это означает, что поды не будут назначены на worker1, если в их манифестах не будет указана toleration для этого taint.

В манифесте пода или деплоймента вы указываете toleration:

yaml
Копировать код
spec:
  tolerations:
  - key: "key"
    operator: "Equal"
    value: "value"
    effect: "NoSchedule"
Это позволяет подам толчить на узел с указанным taint.

Резюме:

Если узел имеет taint и под не имеет соответствующую toleration, то этот под не будет назначен на этот узел.
Если не указаны taints на узле, то поды могут быть назначены на него без ограничений.
Taints и tolerations являются механизмом для ограничения узлов, на которых могут размещаться поды, в то время как labels и nodeSelector используются для выбора узлов, на которых поды будут запускаться.
3. Отличие от nodeSelector:
nodeSelector используется для явного выбора узлов для подов на основе labels.
taints и tolerations работают как механизм фильтрации, запрещающий или разрешающий назначение подов на узлы с определенными taints.
4. Как это работает в связке:
Если в узле есть taints, поды не будут назначены на него без tolerations. Даже если вы укажете правильный label с nodeSelector, если узел имеет taint и под не укажет tolerations, он не будет назначен на этот узел.
Если нет taints, то поды могут быть назначены на узел без ограничений, даже если у него есть labels, не совпадающие с nodeSelector в манифесте пода.
Пример всей картины:
На узле worker1 есть taint:

bash
Копировать код
kubectl taint nodes worker1 key=value:NoSchedule
Ваш деплоймент выглядит так:

yaml
Копировать код
apiVersion: apps/v1
kind: Deployment
metadata:
  name: my-app
spec:
  replicas: 3
  selector:
    matchLabels:
      app: my-app
  template:
    metadata:
      labels:
        app: my-app
    spec:
      containers:
      - name: my-app
        image: nginx
      nodeSelector:
        kubernetes.io/os: linux
      tolerations:
      - key: "key"
        operator: "Equal"
        value: "value"
        effect: "NoSchedule"
Поды из этого деплоймента могут быть назначены на worker1, потому что у подов есть toleration для taint, установленного на этом узле.

Вывод:
nodeSelector и labels позволяют выбрать узлы, на которых поды будут запускаться.
taints и tolerations работают как механизм разрешения или блокировки подов для узлов, где есть taints.
Без указания tolerations поды не смогут быть назначены на узлы с taints.
